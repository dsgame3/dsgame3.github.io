/**
 * Minified by jsDelivr using Terser v5.37.0.
 * Original file: /npm/nostalgist@0.11.0/dist/nostalgist.umd.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Nostalgist=t()}(this,(function(){"use strict";var e=Object.defineProperty,t=(t,a,s)=>((t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s)(t,"symbol"!=typeof a?a+"":a,s);const a={gb:"mgba",gba:"mgba",gbc:"mgba",megadrive:"genesis_plus_gx",nes:"fceumm",snes:"snes9x"},s={2048:{corename:"2048",savestate:!0,supportsNoGame:!0},"3dengine":{corename:"3DEngine"},"4do":{corename:"4DO",savestate:!0},81:{corename:"81",savestate:!0},a5200:{corename:"a5200",savestate:!0},advanced_tests:{corename:"Advanced Test",supportsNoGame:!0},ardens:{corename:"Ardens",savestate:!0},arduous:{corename:"Arduous"},atari800:{corename:"Atari800",savestate:!0},bk:{corename:"bk",savestate:!0},blastem:{corename:"BlastEm",savestate:!0},bluemsx:{corename:"blueMSX",savestate:!0},bnes:{corename:"bnes/higan",savestate:!0},boom3:{corename:"boom3"},boom3_xp:{corename:"boom3_xp"},bsnes:{corename:"bsnes",savestate:!0},bsnes_cplusplus98:{cheats:!0,corename:"bsnes C++98 (v085)",savestate:!0},bsnes_hd_beta:{corename:"bsnes-hd beta",savestate:!0},bsnes_mercury_accuracy:{cheats:!0,corename:"bsnes-mercury Accuracy",savestate:!0},bsnes_mercury_balanced:{cheats:!0,corename:"bsnes-mercury Balanced",savestate:!0},bsnes_mercury_performance:{cheats:!0,corename:"bsnes-mercury Performance",savestate:!0},bsnes2014_accuracy:{cheats:!0,corename:"bsnes 2014 Accuracy",savestate:!0},bsnes2014_balanced:{cheats:!0,corename:"bsnes 2014 Balanced",savestate:!0},bsnes2014_performance:{cheats:!0,corename:"bsnes 2014 Performance",savestate:!0},cannonball:{corename:"Cannonball",supportsNoGame:!0},cap32:{corename:"Caprice32",savestate:!0,supportsNoGame:!0},cdi2015:{corename:"Philips CDi 2015"},chailove:{cheats:!0,corename:"ChaiLove",savestate:!0},chimerasnes:{cheats:!0,corename:"ChimeraSNES",savestate:!0},citra:{corename:"Citra",savestate:!0},citra_canary:{corename:"Citra Canary/Experimental"},citra2018:{corename:"Citra 2018"},craft:{corename:"Craft",supportsNoGame:!0},crocods:{corename:"CrocoDS",savestate:!0},cruzes:{corename:"Cruzes",supportsNoGame:!0},daphne:{corename:"Daphne"},desmume:{cheats:!0,corename:"DeSmuME",savestate:!0},desmume2015:{cheats:!0,corename:"DeSmuME 2015",savestate:!0},dinothawr:{corename:"Dinothawr",supportsNoGame:!0},directxbox:{corename:"DirectXBox"},dirksimple:{corename:"DirkSimple",savestate:!0},dolphin:{corename:"Dolphin",savestate:!0},dolphin_launcher:{corename:"Dolphin Launcher",supportsNoGame:!0},dosbox:{corename:"DOSBox",supportsNoGame:!0},dosbox_core:{corename:"DOSBox-core",supportsNoGame:!0},dosbox_pure:{cheats:!0,corename:"DOSBox-pure",savestate:!0,supportsNoGame:!0},dosbox_svn:{corename:"DOSBox-SVN",supportsNoGame:!0},dosbox_svn_ce:{corename:"DOSBox-SVN CE",supportsNoGame:!0},duckstation:{corename:"DuckStation",savestate:!0},easyrpg:{corename:"EasyRPG Player"},ecwolf:{corename:"ECWolf",savestate:!0},emuscv:{corename:"EmuSCV",supportsNoGame:!0},emux_chip8:{corename:"Emux CHIP-8"},emux_gb:{corename:"Emux GB"},emux_nes:{corename:"Emux NES"},emux_sms:{corename:"Emux SMS"},ep128emu_core:{cheats:!0,corename:"ep128emu-core",savestate:!0,supportsNoGame:!0},fake08:{corename:"FAKE-08",savestate:!0},fbalpha2012:{corename:"FB Alpha 2012",savestate:!0},fbalpha2012_cps1:{corename:"FB Alpha 2012 CPS-1",savestate:!0},fbalpha2012_cps2:{corename:"FB Alpha 2012 CPS-2",savestate:!0},fbalpha2012_cps3:{corename:"FB Alpha 2012 CPS-3",savestate:!0},fbalpha2012_neogeo:{corename:"FB Alpha 2012 Neo Geo",savestate:!0},fbneo:{cheats:!0,corename:"FinalBurn Neo",savestate:!0},fceumm:{cheats:!0,corename:"FCEUmm",savestate:!0},ffmpeg:{corename:"FFmpeg"},fixgb:{corename:"fixGB"},fixnes:{corename:"fixNES"},flycast:{corename:"Flycast",savestate:!0},flycast_gles2:{corename:"Flycast GLES2",savestate:!0},fmsx:{corename:"fMSX"},freechaf:{corename:"FreeChaF"},freeintv:{corename:"FreeIntv"},freej2me:{corename:"FreeJ2ME"},frodo:{corename:"Frodo"},fsuae:{corename:"FS-UAE"},fuse:{corename:"Fuse"},galaksija:{corename:"galaksija",supportsNoGame:!0},gambatte:{corename:"Gambatte",savestate:!0},gearboy:{corename:"Gearboy"},gearcoleco:{corename:"Gearcoleco"},gearsystem:{corename:"Gearsystem"},genesis_plus_gx:{cheats:!0,corename:"Genesis Plus GX",savestate:!0},genesis_plus_gx_wide:{cheats:!0,corename:"Genesis Plus GX Wide",savestate:!0},gme:{corename:"Game Music Emu"},gong:{corename:"Gong",savestate:!0,supportsNoGame:!0},gpsp:{corename:"gpSP",savestate:!0},gw:{corename:"GW"},handy:{corename:"Handy",savestate:!0},hatari:{corename:"Hatari",savestate:!0},hbmame:{corename:"HBMAME (Git)"},higan_sfc:{corename:"nSide (Super Famicom Accuracy)",savestate:!0},higan_sfc_balanced:{corename:"nSide (Super Famicom Balanced)",savestate:!0},imageviewer:{corename:"Imageviewer"},ishiiruka:{corename:"Ishiiruka",savestate:!0},jaxe:{corename:"JAXE"},jumpnbump:{corename:"jumpnbump"},kronos:{cheats:!0,corename:"Kronos",savestate:!0},lowresnx:{corename:"lowresnx"},lutro:{corename:"Lutro"},mame:{corename:"MAME",savestate:!0},mame2000:{corename:"MAME 2000 (0.37b5)",savestate:!0},mame2003:{corename:"MAME 2003 (0.78)",savestate:!0},mame2003_midway:{corename:"MAME 2003 Midway (0.78)",savestate:!0},mame2003_plus:{corename:"MAME 2003-Plus",savestate:!0},mame2009:{corename:"MAME 2009 (0.135u4)"},mame2010:{corename:"MAME 2010 (0.139)"},mame2015:{corename:"MAME 2015 (0.160)"},mame2016:{corename:"MAME 2016 (0.174)"},mamearcade:{corename:"MAME (Git)"},mamemess:{corename:"MESS (Git)",savestate:!0},mednafen_gba:{corename:"Beetle GBA"},mednafen_lynx:{corename:"Beetle Lynx"},mednafen_ngp:{corename:"Beetle NeoPop",savestate:!0},mednafen_pce:{corename:"Beetle PCE",savestate:!0},mednafen_pce_fast:{corename:"Beetle PCE Fast",savestate:!0},mednafen_pcfx:{corename:"Beetle PC-FX"},mednafen_psx:{cheats:!0,corename:"Beetle PSX",savestate:!0},mednafen_psx_hw:{cheats:!0,corename:"Beetle PSX HW",savestate:!0},mednafen_saturn:{cheats:!0,corename:"Beetle Saturn",savestate:!0},mednafen_snes:{corename:"Beetle bsnes",savestate:!0},mednafen_supafaust:{cheats:!0,corename:"Beetle Supafaust",savestate:!0},mednafen_supergrafx:{cheats:!0,corename:"Beetle SuperGrafx",savestate:!0},mednafen_vb:{corename:"Beetle VB"},mednafen_wswan:{corename:"Beetle WonderSwan",savestate:!0},melonds:{corename:"melonDS"},mesen:{cheats:!0,corename:"Mesen",savestate:!0},"mesen-s":{corename:"Mesen-S"},mess2015:{corename:"MESS 2015 (0.160)"},meteor:{corename:"Meteor"},mgba:{cheats:!0,corename:"mGBA",savestate:!0},minivmac:{corename:"MinivmacII"},mojozork:{corename:"mojozork",savestate:!0},moonlight:{corename:"Moonlight",supportsNoGame:!0},mpv:{corename:"MPV"},mrboom:{corename:"Mr.Boom",savestate:!0,supportsNoGame:!0},mu:{corename:"Mu",supportsNoGame:!0},mupen64plus_next:{cheats:!0,corename:"Mupen64Plus-Next",savestate:!0},mupen64plus_next_develop:{cheats:!0,corename:"Mupen64Plus-Next",savestate:!0},mupen64plus_next_gles2:{cheats:!0,corename:"Mupen64Plus-Next",savestate:!0},mupen64plus_next_gles3:{cheats:!0,corename:"Mupen64Plus-Next",savestate:!0},nekop2:{corename:"Neko Project II",savestate:!0},neocd:{corename:"NeoCD"},nes:{corename:"nes",savestate:!0},nestopia:{cheats:!0,corename:"Nestopia",savestate:!0},np2kai:{corename:"Neko Project II Kai",savestate:!0},numero:{corename:"Numero",savestate:!0,supportsNoGame:!0},nxengine:{corename:"NXEngine",supportsNoGame:!0},o2em:{corename:"O2EM",savestate:!0},oberon:{corename:"Oberon"},openlara:{corename:"OpenLara"},opentyrian:{corename:"OpenTyrian",supportsNoGame:!0},opera:{corename:"Opera",savestate:!0,supportsNoGame:!0},parallel_n64:{corename:"ParaLLEl N64",savestate:!0},parallel_n64_debug:{corename:"ParaLLEl (Debug)",savestate:!0},pascal_pong:{corename:"PascalPong",supportsNoGame:!0},pcem:{corename:"PCem",supportsNoGame:!0},pcsx_rearmed:{cheats:!0,corename:"PCSX-ReARMed",savestate:!0},pcsx_rearmed_interpreter:{cheats:!0,corename:"PCSX ReARMed [Interpreter]",savestate:!0},pcsx_rearmed_neon:{cheats:!0,corename:"PCSX ReARMed [NEON]",savestate:!0},pcsx1:{corename:"PCSX1"},pcsx2:{corename:"LRPS2",savestate:!0},picodrive:{cheats:!0,corename:"PicoDrive",savestate:!0},play:{corename:"Play!",savestate:!0},pocketcdg:{corename:"PocketCDG"},pokemini:{corename:"PokeMini",savestate:!0},potator:{corename:"Potator",savestate:!0},ppsspp:{corename:"PPSSPP",savestate:!0},prboom:{cheats:!0,corename:"PrBoom",savestate:!0},prosystem:{corename:"ProSystem",savestate:!0},puae:{cheats:!0,corename:"PUAE",savestate:!0,supportsNoGame:!0},puae2021:{cheats:!0,corename:"PUAE 2021",savestate:!0,supportsNoGame:!0},puzzlescript:{corename:"puzzlescript",savestate:!0},px68k:{corename:"PX68k",supportsNoGame:!0},quasi88:{cheats:!0,corename:"QUASI88",savestate:!0,supportsNoGame:!0},quicknes:{corename:"QuickNES",savestate:!0},race:{corename:"RACE",savestate:!0},redbook:{corename:"Redbook"},reminiscence:{corename:"REminiscence",savestate:!0},remotejoy:{corename:"RemoteJoy",supportsNoGame:!0},retro8:{corename:"Retro8"},retrodream:{corename:"RetroDream"},rustation:{corename:"Rustation"},same_cdi:{corename:"SAME CDi (Git)"},sameboy:{corename:"SameBoy"},sameduck:{corename:"SameDuck",savestate:!0},scummvm:{corename:"ScummVM",supportsNoGame:!0},simcp:{corename:"SimCoupe"},smsplus:{corename:"SMS Plus GX"},snes9x:{cheats:!0,corename:"Snes9x",savestate:!0},snes9x2002:{cheats:!0,corename:"Snes9x 2002",savestate:!0},snes9x2005:{cheats:!0,corename:"Snes9x 2005",savestate:!0},snes9x2005_plus:{cheats:!0,corename:"Snes9x 2005 Plus",savestate:!0},snes9x2010:{cheats:!0,corename:"Snes9x 2010",savestate:!0},squirreljme:{corename:"SquirrelJME",supportsNoGame:!0},stella:{corename:"Stella",savestate:!0},stella2014:{corename:"Stella 2014",savestate:!0},stonesoup:{corename:"Dungeon Crawl Stone Soup"},superbroswar:{corename:"superbroswar"},swanstation:{corename:"SwanStation",savestate:!0},tempgba:{corename:"TempGBA"},test:{corename:"Test",supportsNoGame:!0},test_netplay:{corename:"netplay-test",supportsNoGame:!0},testaudio_callback:{corename:"TestAudio Callback",supportsNoGame:!0},testaudio_no_callback:{corename:"TestAudio NoCallback",supportsNoGame:!0},testaudio_playback_wav:{corename:"TestAudio Playback Wav",supportsNoGame:!0},testgl:{corename:"TestGL",supportsNoGame:!0},testgl_compute_shaders:{corename:"TestGL ComputeShaders",supportsNoGame:!0},testgl_ff:{corename:"TestGL (FF)",supportsNoGame:!0},testinput_buttontest:{corename:"Button Test",supportsNoGame:!0},testretroluxury:{corename:"Test RetroLuxury",supportsNoGame:!0},testsw:{corename:"TestSW",supportsNoGame:!0},testsw_vram:{corename:"TestSW VRAM",supportsNoGame:!0},testvulkan:{corename:"TestVulkan",supportsNoGame:!0},testvulkan_async_compute:{corename:"TestVulkan AsyncCompute",supportsNoGame:!0},tgbdual:{corename:"TGB Dual",savestate:!0},theodore:{corename:"theodore",savestate:!0,supportsNoGame:!0},thepowdertoy:{corename:"ThePowderToy",savestate:!0,supportsNoGame:!0},tic80:{cheats:!0,corename:"TIC-80",savestate:!0},tyrquake:{cheats:!0,corename:"TyrQuake"},uae4arm:{corename:"UAE4ARM",savestate:!0},ume2015:{corename:"UME 2015 (0.160)"},uw8:{corename:"MicroW8",savestate:!0},uzem:{corename:"uzem",savestate:!0},vaporspec:{corename:"VaporSpec",savestate:!0},vba_next:{corename:"VBA Next",savestate:!0},vbam:{cheats:!0,corename:"VBA-M",savestate:!0},vecx:{corename:"vecx",savestate:!0},vemulator:{corename:"VeMUlator"},vice_x128:{cheats:!0,corename:"VICE x128",savestate:!0,supportsNoGame:!0},vice_x64:{cheats:!0,corename:"VICE x64",savestate:!0,supportsNoGame:!0},vice_x64dtv:{cheats:!0,corename:"VICE x64dtv",savestate:!0,supportsNoGame:!0},vice_x64sc:{cheats:!0,corename:"VICE x64sc",savestate:!0,supportsNoGame:!0},vice_xcbm2:{cheats:!0,corename:"VICE xcbm2",savestate:!0,supportsNoGame:!0},vice_xcbm5x0:{cheats:!0,corename:"VICE xcbm5x0",savestate:!0,supportsNoGame:!0},vice_xpet:{cheats:!0,corename:"VICE xpet",savestate:!0,supportsNoGame:!0},vice_xplus4:{cheats:!0,corename:"VICE xplus4",savestate:!0,supportsNoGame:!0},vice_xscpu64:{cheats:!0,corename:"VICE xscpu64",savestate:!0,supportsNoGame:!0},vice_xvic:{cheats:!0,corename:"VICE xvic",savestate:!0,supportsNoGame:!0},vircon32:{corename:"Vircon32",supportsNoGame:!0},virtualjaguar:{corename:"Virtual Jaguar"},virtualxt:{corename:"virtualxt"},vitaquake2:{corename:"vitaQuake 2"},"vitaquake2-rogue":{corename:"vitaQuake 2 [Rogue]"},"vitaquake2-xatrix":{corename:"vitaQuake 2 [Xatrix]"},"vitaquake2-zaero":{corename:"vitaQuake 2 [Zaero]"},vitaquake3:{corename:"vitaQuake 3"},vitavoyager:{corename:"vitaVoyager"},wasm4:{corename:"WASM-4",savestate:!0},x1:{corename:"x1"},x64sdl:{corename:"VICE SDL"},xrick:{corename:"XRick",supportsNoGame:!0},yabasanshiro:{cheats:!0,corename:"YabaSanshiro",savestate:!0},yabause:{cheats:!0,corename:"Yabause",savestate:!0}},n={add:"NumpadAdd",alt:"AltLeft",backquote:"Backquote",backslash:"",backspace:"Backspace",capslock:"CapsLock",comma:"Comma",ctrl:"ControlLeft",del:"Delete",divide:"NumpadDivide",down:"ArrowDown",end:"End",enter:"Enter",equals:"Equal",escape:"Escape",home:"Home",insert:"Insert",kp_enter:"NumpadEnter",kp_equals:"NumpadEquals",kp_minus:"NumpadSubtract",kp_period:"NumpadDecimal",kp_plus:"NumpadAdd",left:"ArrowLeft",leftbracket:"BracketLeft",minus:"Minus",multiply:"NumpadMultiply",numlock:"NumLock",pagedown:"PageDown",pageup:"PageUp",pause:"Pause",period:"Period",print_screen:"PrintScreen",quote:"Quote",ralt:"AltRight",rctrl:"ControlRight",right:"ArrowRight",rightbracket:"BracketRight",rshift:"ShiftRight",scroll_lock:"ScrollLock",semicolon:"Semicolon",shift:"ShiftLeft",slash:"Slash",space:"Space",subtract:"NumpadSubtract",tab:"Tab",tilde:"",up:"ArrowUp"};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const{hasOwnProperty:o}=Object.prototype,i=(e,t={})=>{"string"==typeof t&&(t={section:t}),t.align=!0===t.align,t.newline=!0===t.newline,t.sort=!0===t.sort,t.whitespace=!0===t.whitespace||!0===t.align,t.platform=t.platform||"undefined"!=typeof process&&process.platform,t.bracketedArray=!1!==t.bracketedArray;const a="win32"===t.platform?"\r\n":"\n",s=t.whitespace?" = ":"=",n=[],r=t.sort?Object.keys(e).sort():Object.keys(e);let o=0;t.align&&(o=u(r.filter((t=>null===e[t]||Array.isArray(e[t])||"object"!=typeof e[t])).map((t=>Array.isArray(e[t])?`${t}[]`:t)).concat([""]).reduce(((e,t)=>u(e).length>=u(t).length?e:t))).length);let m="";const l=t.bracketedArray?"[]":"";for(const t of r){const r=e[t];if(r&&Array.isArray(r))for(const e of r)m+=u(`${t}${l}`).padEnd(o," ")+s+u(e)+a;else r&&"object"==typeof r?n.push(t):m+=u(t).padEnd(o," ")+s+u(r)+a}t.section&&m.length&&(m="["+u(t.section)+"]"+(t.newline?a+a:a)+m);for(const s of n){const n=c(s,".").join("\\."),r=(t.section?t.section+".":"")+n,o=i(e[s],{...t,section:r});m.length&&o.length&&(m+=a),m+=o}return m};function c(e,t){var a=0,s=0,n=0,r=[];do{if(-1!==(n=e.indexOf(t,a))){if(a=n+t.length,n>0&&"\\"===e[n-1])continue;r.push(e.slice(s,n)),s=n+t.length}}while(-1!==n);return r.push(e.slice(s)),r}const m=(e,t={})=>{t.bracketedArray=!1!==t.bracketedArray;const a=Object.create(null);let s=a,n=null;const r=/^\[([^\]]*)\]\s*$|^([^=]+)(=(.*))?$/i,i=e.split(/[\r\n]+/g),m={};for(const e of i){if(!e||e.match(/^\s*[;#]/)||e.match(/^\s*$/))continue;const i=e.match(r);if(!i)continue;if(void 0!==i[1]){if(n=p(i[1]),"__proto__"===n){s=Object.create(null);continue}s=a[n]=a[n]||Object.create(null);continue}const c=p(i[2]);let l;t.bracketedArray?l=c.length>2&&"[]"===c.slice(-2):(m[c]=((null==m?void 0:m[c])||0)+1,l=m[c]>1);const u=l&&c.endsWith("[]")?c.slice(0,-2):c;if("__proto__"===u)continue;const h=!i[3]||p(i[4]),d="true"===h||"false"===h||"null"===h?JSON.parse(h):h;l&&(o.call(s,u)?Array.isArray(s[u])||(s[u]=[s[u]]):s[u]=[]),Array.isArray(s[u])?s[u].push(d):s[u]=d}const l=[];for(const e of Object.keys(a)){if(!o.call(a,e)||"object"!=typeof a[e]||Array.isArray(a[e]))continue;const t=c(e,".");s=a;const n=t.pop(),r=n.replace(/\\\./g,".");for(const e of t)"__proto__"!==e&&(o.call(s,e)&&"object"==typeof s[e]||(s[e]=Object.create(null)),s=s[e]);s===a&&r===n||(s[r]=a[e],l.push(e))}for(const e of l)delete a[e];return a},l=e=>e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'"),u=e=>"string"!=typeof e||e.match(/[=\r\n]/)||e.match(/^\[/)||e.length>1&&l(e)||e!==e.trim()?JSON.stringify(e):e.split(";").join("\\;").split("#").join("\\#"),p=e=>{if(e=(e||"").trim(),!l(e)){let t=!1,a="";for(let s=0,n=e.length;s<n;s++){const n=e.charAt(s);if(t)-1!=="\\;#".indexOf(n)?a+=n:a+="\\"+n,t=!1;else{if(-1!==";#".indexOf(n))break;"\\"===n?t=!0:a+=n}}return t&&(a+="\\"),a.trim()}"'"===e.charAt(0)&&(e=e.slice(1,-1));try{e=JSON.parse(e)}catch{}return e};const h=r({parse:m,decode:m,stringify:i,encode:i,safe:u,unsafe:p});function d(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function f(e,t){for(var a,s="",n=0,r=-1,o=0,i=0;i<=e.length;++i){if(i<e.length)a=e.charCodeAt(i);else{if(47===a)break;a=47}if(47===a){if(r===i-1||1===o);else if(r!==i-1&&2===o){if(s.length<2||2!==n||46!==s.charCodeAt(s.length-1)||46!==s.charCodeAt(s.length-2))if(s.length>2){var c=s.lastIndexOf("/");if(c!==s.length-1){-1===c?(s="",n=0):n=(s=s.slice(0,c)).length-1-s.lastIndexOf("/"),r=i,o=0;continue}}else if(2===s.length||1===s.length){s="",n=0,r=i,o=0;continue}t&&(s.length>0?s+="/..":s="..",n=2)}else s.length>0?s+="/"+e.slice(r+1,i):s=e.slice(r+1,i),n=i-r-1;r=i,o=0}else 46===a&&-1!==o?++o:o=-1}return s}var g={resolve:function(){for(var e,t="",a=!1,s=arguments.length-1;s>=-1&&!a;s--){var n;s>=0?n=arguments[s]:(void 0===e&&(e=process.cwd()),n=e),d(n),0!==n.length&&(t=n+"/"+t,a=47===n.charCodeAt(0))}return t=f(t,!a),a?t.length>0?"/"+t:"/":t.length>0?t:"."},normalize:function(e){if(d(e),0===e.length)return".";var t=47===e.charCodeAt(0),a=47===e.charCodeAt(e.length-1);return 0!==(e=f(e,!t)).length||t||(e="."),e.length>0&&a&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return d(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,t=0;t<arguments.length;++t){var a=arguments[t];d(a),a.length>0&&(void 0===e?e=a:e+="/"+a)}return void 0===e?".":g.normalize(e)},relative:function(e,t){if(d(e),d(t),e===t)return"";if((e=g.resolve(e))===(t=g.resolve(t)))return"";for(var a=1;a<e.length&&47===e.charCodeAt(a);++a);for(var s=e.length,n=s-a,r=1;r<t.length&&47===t.charCodeAt(r);++r);for(var o=t.length-r,i=n<o?n:o,c=-1,m=0;m<=i;++m){if(m===i){if(o>i){if(47===t.charCodeAt(r+m))return t.slice(r+m+1);if(0===m)return t.slice(r+m)}else n>i&&(47===e.charCodeAt(a+m)?c=m:0===m&&(c=0));break}var l=e.charCodeAt(a+m);if(l!==t.charCodeAt(r+m))break;47===l&&(c=m)}var u="";for(m=a+c+1;m<=s;++m)m!==s&&47!==e.charCodeAt(m)||(0===u.length?u+="..":u+="/..");return u.length>0?u+t.slice(r+c):(r+=c,47===t.charCodeAt(r)&&++r,t.slice(r))},_makeLong:function(e){return e},dirname:function(e){if(d(e),0===e.length)return".";for(var t=e.charCodeAt(0),a=47===t,s=-1,n=!0,r=e.length-1;r>=1;--r)if(47===(t=e.charCodeAt(r))){if(!n){s=r;break}}else n=!1;return-1===s?a?"/":".":a&&1===s?"//":e.slice(0,s)},basename:function(e,t){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');d(e);var a,s=0,n=-1,r=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var o=t.length-1,i=-1;for(a=e.length-1;a>=0;--a){var c=e.charCodeAt(a);if(47===c){if(!r){s=a+1;break}}else-1===i&&(r=!1,i=a+1),o>=0&&(c===t.charCodeAt(o)?-1==--o&&(n=a):(o=-1,n=i))}return s===n?n=i:-1===n&&(n=e.length),e.slice(s,n)}for(a=e.length-1;a>=0;--a)if(47===e.charCodeAt(a)){if(!r){s=a+1;break}}else-1===n&&(r=!1,n=a+1);return-1===n?"":e.slice(s,n)},extname:function(e){d(e);for(var t=-1,a=0,s=-1,n=!0,r=0,o=e.length-1;o>=0;--o){var i=e.charCodeAt(o);if(47!==i)-1===s&&(n=!1,s=o+1),46===i?-1===t?t=o:1!==r&&(r=1):-1!==t&&(r=-1);else if(!n){a=o+1;break}}return-1===t||-1===s||0===r||1===r&&t===s-1&&t===a+1?"":e.slice(t,s)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var a=t.dir||t.root,s=t.base||(t.name||"")+(t.ext||"");return a?a===t.root?a+s:a+e+s:s}("/",e)},parse:function(e){d(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;var a,s=e.charCodeAt(0),n=47===s;n?(t.root="/",a=1):a=0;for(var r=-1,o=0,i=-1,c=!0,m=e.length-1,l=0;m>=a;--m)if(47!==(s=e.charCodeAt(m)))-1===i&&(c=!1,i=m+1),46===s?-1===r?r=m:1!==l&&(l=1):-1!==r&&(l=-1);else if(!c){o=m+1;break}return-1===r||-1===i||0===l||1===l&&r===i-1&&r===o+1?-1!==i&&(t.base=t.name=0===o&&n?e.slice(1,i):e.slice(o,i)):(0===o&&n?(t.name=e.slice(1,r),t.base=e.slice(1,i)):(t.name=e.slice(o,r),t.base=e.slice(o,i)),t.ext=e.slice(r,i)),o>0?t.dir=e.slice(0,o-1):n&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};g.posix=g;const v={ini:h,path:r(g)},{path:y}=v,b=new TextEncoder;function _(e){let t=e;try{t=new URL(e).pathname}catch{}const a=y.basename(t);try{return decodeURIComponent(a)}catch{return a}}async function w(e){const t=await e.arrayBuffer();return new Uint8Array(t)}function E(e){return new Promise((t=>{setTimeout(t,e)}))}function S(e){return null==e}function C(e){if(S(e))return!1;const{constructor:t}=e;return t===Object||!t}function x(e,t){for(const a in t)if(Object.prototype.hasOwnProperty.call(t,a)){const s=e[a],n=t[a];S(s)?e[a]=n:Array.isArray(s)&&Array.isArray(n)?e[a]=[...s,...n]:C(s)&&C(n)?(e[a]=C(s)?e[a]:{},x(e[a],n)):e[a]=n}}function N(e,...t){for(const a of t)x(e,a)}function A(e){if(null==e?void 0:e.aborted)throw new Error("Launch aborted")}function k(e){return(e<10?"0":"")+e}const{ini:F,path:M}=v,G="/home/web_user/retroarch/userdata",O=M.join(G,"content"),P=M.join(G,"system"),B=M.join(G,"config"),T=M.join("/home/web_user/retroarch/bundle","shaders","shaders_glsl"),j=M.join(G,"retroarch.cfg"),R=M.join(G,"retroarch-core-options.cfg");class D{constructor(e){t(this,"canvasInitialSize",{height:0,width:0}),t(this,"gameStatus","initial"),t(this,"messageQueue",[]),t(this,"options"),t(this,"emscripten"),this.options=e}clearStateFile(){const{Module:e}=this.getEmscripten(),{FS:t}=e;try{t.unlink(this.stateFileName),t.unlink(this.stateThumbnailFileName)}catch{}}fireKeyboardEvent(e,t){const{JSEvents:a}=this.getEmscripten();for(const{eventListenerFunc:s,eventTypeString:n}of a.eventHandlers)if(n===e)try{s({code:t,target:this.options.element})}catch{}}getCurrentRetroarchConfig(){const{Module:e}=this.getEmscripten(),{FS:t}=e,a=t.readFile(j,{encoding:"utf8"});return F.parse(a)}getElementSize(){const{element:e,size:t}=this.options;return t&&"auto"!==t?t:{height:e.offsetHeight,width:e.offsetWidth}}getKeyboardCode(e,t=1){const a=this.getCurrentRetroarchConfig()[`input_player${t}_${e}`];if(!a||"nul"===a)return;const{length:s}=a;return 1===s?`Key${a.toUpperCase()}`:"f"!==a[0]||2!==s&&3!==s?4===s&&a.startsWith("num")?`Numpad${a.at(-1)}`:7===s&&a.startsWith("keypad")?`Digit${a.at(-1)}`:n[a]||"":a.toUpperCase()}guessScreenshotFileName(){const e=new Date,t=`${e.getFullYear()%1e3}${k(e.getMonth()+1)}${k(e.getDate())}-${k(e.getHours())}${k(e.getMinutes())}${k(e.getSeconds())}`;return`${this.romBaseName}-${t}.png`}keyboardDown(e){this.fireKeyboardEvent("keydown",e)}async keyboardPress(e,t=100){this.keyboardDown(e),await E(t),this.keyboardUp(e)}keyboardUp(e){this.fireKeyboardEvent("keyup",e)}postRun(){var e;this.resize(this.canvasInitialSize);for(const t of(null==(e=navigator.getGamepads)?void 0:e.call(navigator))??[])t&&window.dispatchEvent(new GamepadEvent("gamepadconnected",{gamepad:t}));this.updateKeyboardEventHandlers()}runMain(){A(this.options.signal);const{Module:e}=this.getEmscripten(),{arguments:t=[]}=e,{rom:a,signal:s}=this.options;if(!e.arguments&&a.length>0){const[{fileName:e}]=a;t.push(M.join(O,e))}e.callMain(t),null==s||s.addEventListener("abort",(()=>{this.exit()})),this.gameStatus="running",this.postRun()}async setupEmscripten(){var e;"object"==typeof window&&(window.setImmediate??(window.setImmediate=window.setTimeout));const{core:t,element:a,emscriptenModule:s,signal:n}=this.options,{wasm:r}=t,o=function(e){let t;const a=new Promise((e=>{t=e}));return{noExitRuntime:!1,noInitialRun:!0,locateFile:e=>e,monitorRunDependencies:async e=>(0===e&&t(),await a),print(...e){console.info(...e)},printErr(...e){console.error(...e)},quit(e,t){e&&console.info(e,t)},...e}}({canvas:a,preRun:[],wasmBinary:r,...s});null==(e=o.preRun)||e.push((()=>o.FS.init((()=>this.stdin()))));const{getEmscripten:i}=await async function({js:e,name:t}){const a=function({js:e,name:t}){let a=e;return function(e){return e.startsWith("var Module")}(e)?a=`export function getEmscripten({ Module }) {\n        ${e};\n        Module.FS = FS;\n        Module.PATH = PATH;\n        Module.ERRNO_CODES = ERRNO_CODES;\n        return {\n          AL: typeof AL === 'undefined' ? null: AL,\n          Browser: typeof Browser === 'undefined' ? null: Browser,\n          JSEvents,\n          Module,\n          exit: _emscripten_force_exit\n         }\n      }`:function(e){return e.includes("import.meta.url")}(e)&&(a=`${e.replace("readyPromiseResolve(Module)","readyPromiseResolve({\n        AL: typeof AL === 'undefined' ? null: AL,\n        Browser: typeof Browser === 'undefined' ? null: Browser,\n        JSEvents,\n        Module,\n        exit: _emscripten_force_exit\n      })")};\n      export function getEmscripten({ Module }) {\n        return (libretro_${t} || ${t})(Module)\n      }\n    `),a}({js:e,name:t}),s=new Blob([a],{type:"application/javascript"}),n=URL.createObjectURL(s);if(!n)throw new Error("invalid jsBlob");try{return await import(n)}catch{return await new Function("return import(jsBlobUrl)")()}finally{URL.revokeObjectURL(n)}}(t),c=await i({Module:o});this.emscripten=c;const{Module:m}=c;await m.monitorRunDependencies(),A(n),await this.setupFileSystem()}async setupFileSystem(){const{Module:e}=this.getEmscripten(),{FS:t}=e,{bios:a,rom:s,signal:n,state:r}=this.options;s.length>0&&t.mkdirTree(O),a.length>0&&t.mkdirTree(P),r&&t.mkdirTree(this.stateFileDirectory);let o=0;for(;!e.asm&&o<100;)await E(10),A(n),o+=5;const i=[];if(i.push(...s.map((e=>this.writeBlobToDirectory({...e,directory:O}))),...a.map((e=>this.writeBlobToDirectory({...e,directory:P})))),r){const e=this.writeBlobToDirectory({directory:this.stateFileDirectory,fileContent:r,fileName:`${this.romBaseName}.state.auto`});i.push(e)}await Promise.all(i),A(n)}async setupRaConfigFile(){this.writeConfigFile({config:this.options.retroarchConfig,path:j}),this.writeConfigFile({config:this.options.retroarchCoreConfig,path:R}),await this.setupRaShaderFile()}async setupRaShaderFile(){const{shader:e}=this.options;if(0===e.length)return;const t=e.filter((e=>e.fileName.endsWith(".glslp")));if(0===t.length)return;const a=t.map((e=>`#reference "${M.join(T,e.fileName)}"`)).join("\n");this.writeTextToDirectory({directory:B,fileContent:a,fileName:"global.glslp"}),await Promise.all(e.map((async({fileContent:e,fileName:t})=>{const a=t.endsWith(".glslp")?T:M.join(T,"shaders");await this.writeBlobToDirectory({directory:a,fileContent:e,fileName:t})})))}stdin(){const{messageQueue:e}=this;for(;e.length>0;){const t=e[0][0],a=e[0][1];if(!(a>=t.length))return e[0][1]=a+1,t[a];e.shift()}return null}updateKeyboardEventHandlers(){const{JSEvents:e}=this.getEmscripten(),{element:t,respondToGlobalEvents:a}=this.options;a||(t.getAttribute("tabindex")||(t.tabIndex=-1),t.focus(),t.addEventListener("click",(()=>{t.focus()})));const s=new Set(["keyup","keydown","keypress"]),n=e.eventHandlers.filter((({eventTypeString:e,target:a})=>s.has(e)&&(a===document||a===t)));for(const s of n){const{eventTypeString:n,handlerFunc:r,target:o}=s;e.registerOrRemoveHandler({eventTypeString:n,target:o}),e.registerOrRemoveHandler({...s,handlerFunc:(...e)=>{const[s]=e;(a||(null==s?void 0:s.target)===t)&&r(...e)},target:a?document:t})}}async waitForEmscriptenFile(e){const{Module:t}=this.getEmscripten(),{FS:a}=t;let s,n=!1,r=0;for(;r<=30&&!n;){const t=Math.min(100*2**r,1e3);await E(t);try{const t=a.readFile(e).buffer;n=(null==s?void 0:s.byteLength)>0&&(null==s?void 0:s.byteLength)===t.byteLength,s=t}catch(e){console.warn(e)}r+=1}if(!n)throw new Error("fs timeout");return s}async writeBlobToDirectory({directory:e,fileContent:t,fileName:a}){const{Module:s}=this.getEmscripten(),{FS:n}=s,r=await w(t);n.createDataFile("/",a,r,!0,!1);const o="binary",i=n.readFile(a,{encoding:o});n.mkdirTree(e),n.writeFile(M.join(e,a),i,{encoding:o}),n.unlink(a)}writeConfigFile({config:e,path:t}){const{Module:a}=this.getEmscripten(),{FS:s}=a,n=t.slice(0,t.lastIndexOf("/"));s.mkdirTree(n);for(const t in e)e[t]=`__${e[t]}__`;let r=F.stringify(e,{platform:"linux",whitespace:!0});r=r.replaceAll("__",'"');const o=v.path.basename(t),i=v.path.dirname(t);this.writeTextToDirectory({directory:i,fileContent:r,fileName:o})}writeTextToDirectory({directory:e,fileContent:t,fileName:a}){const{Module:s}=this.getEmscripten(),{FS:n}=s,r=b.encode(t);n.createDataFile("/",a,r,!0,!1);const o="binary",i=n.readFile(a,{encoding:o});n.mkdirTree(e),n.writeFile(M.join(e,a),i,{encoding:o}),n.unlink(a)}exit(e=0){const{emscripten:t}=this;if(t){const{exit:t,JSEvents:a,Module:s}=this.getEmscripten(),{FS:n}=s;t(e),n.unmount("/home"),a.removeAllEventListeners()}}getEmscripten(){if(!this.emscripten)throw new Error("emulator is not ready");return this.emscripten}getOptions(){return this.options}async launch(){await this.setupEmscripten(),A(this.options.signal),await this.setupRaConfigFile(),A(this.options.signal);const{element:e,respondToGlobalEvents:t,signal:a,style:s,waitForInteraction:n}=this.options;if(function(e,t){if(e)for(const a in t){const s=t[a];e.style[a]=s||null}}(e,s),e.isConnected||(document.body.append(e),null==a||a.addEventListener("abort",(()=>{null==e||e.remove()}))),this.canvasInitialSize=this.getElementSize(),!1===t){e.tabIndex&&-1!==e.tabIndex||(e.tabIndex=0);const{activeElement:t}=document;e.focus(),null==a||a.addEventListener("abort",(()=>{t instanceof HTMLElement&&t.focus()}))}const{beforeLaunch:r,nostalgist:o,onLaunch:i}=this.options;r&&await r(o);const c=async()=>{this.runMain(),i&&await i(o)};n?n({done:c}):c()}async loadState(e){this.clearStateFile();const{Module:t}=this.getEmscripten(),{FS:a}=t,s=await w(e);a.writeFile(this.stateFileName,s),await this.waitForEmscriptenFile(this.stateFileName),this.sendCommand("LOAD_STATE")}pause(){"running"===this.gameStatus&&this.sendCommand("PAUSE_TOGGLE"),this.gameStatus="paused"}async press(e,t=1,a=100){const s=this.getKeyboardCode(e,t);s&&await this.keyboardPress(s,a)}pressDown(e,t=1){const a=this.getKeyboardCode(e,t);a&&this.keyboardDown(a)}pressUp(e,t=1){const a=this.getKeyboardCode(e,t);a&&this.keyboardUp(a)}resize({height:e,width:t}){const{Module:a}=this.getEmscripten();"number"==typeof t&&"number"==typeof e&&a.setCanvasSize(t,e)}restart(){this.sendCommand("RESET"),this.resume()}resume(){"paused"===this.gameStatus&&this.sendCommand("PAUSE_TOGGLE"),this.gameStatus="running"}async saveState(){this.clearStateFile(),this.sendCommand("SAVE_STATE");let e,t;this.options.retroarchConfig.savestate_thumbnail_enable?[e,t]=await Promise.all([this.waitForEmscriptenFile(this.stateFileName),this.waitForEmscriptenFile(this.stateThumbnailFileName)]):e=await this.waitForEmscriptenFile(this.stateFileName),this.clearStateFile();return{state:new Blob([e],{type:"application/octet-stream"}),thumbnail:t?new Blob([t],{type:"image/png"}):void 0}}async screenshot(){this.sendCommand("SCREENSHOT");const e=M.join(G,"screenshots"),t=this.guessScreenshotFileName(),a=M.join(e,t),s=await this.waitForEmscriptenFile(a),{Module:n}=this.getEmscripten(),{FS:r}=n;r.unlink(a);return new Blob([s],{type:"image/png"})}sendCommand(e){const t=b.encode(`${e}\n`);this.messageQueue.push([t,0])}get romBaseName(){const{rom:[{fileName:e}]}=this.options;return e.slice(0,e.lastIndexOf("."))}get stateFileDirectory(){const{core:e}=this.options,t=s[e.name].corename;if(!t)throw new Error(`invalid core name: ${e.name}`);return M.join(G,"states",t)}get stateFileName(){return M.join(this.stateFileDirectory,`${this.romBaseName}.state`)}get stateThumbnailFileName(){return`${this.stateFileName}.png`}}const L={menu_driver:"rgui",notification_show_when_menu_is_alive:!0,savestate_auto_load:!0,savestate_thumbnail_enable:!0,stdin_cmd_enable:!0,video_shader_enable:!0,input_audio_mute:"nul",input_cheat_index_minus:"nul",input_cheat_index_plus:"nul",input_cheat_toggle:"nul",input_desktop_menu_toggle:"nul",input_exit_emulator:"nul",input_fps_toggle:"nul",input_frame_advance:"nul",input_game_focus_toggle:"nul",input_grab_mouse_toggle:"nul",input_hold_fast_forward:"nul",input_hold_slowmotion:"nul",input_load_state:"nul",input_netplay_game_watch:"nul",input_netplay_player_chat:"nul",input_pause_toggle:"nul",input_reset:"nul",input_rewind:"nul",input_save_state:"nul",input_screenshot:"nul",input_shader_next:"nul",input_shader_prev:"nul",input_shader_toggle:"nul",input_state_slot_decrease:"nul",input_state_slot_increase:"nul",input_toggle_fast_forward:"nul",input_toggle_fullscreen:"nul",input_volume_down:"nul",input_volume_up:"nul",input_player1_analog_dpad_mode:1,input_player2_analog_dpad_mode:1,input_player3_analog_dpad_mode:1,input_player4_analog_dpad_mode:1},$="https://cdn.jsdelivr.net/gh",I="arianrhodsandlot/retroarch-emscripten-build",W="v1.19.1",U="retroarch",V="libretro/glsl-shaders",z="bc8df9";function H(){return{element:"",retroarchConfig:L,retroarchCoreConfig:{},runEmulatorManually:!1,resolveCoreJs:e=>`${$}/${I}@${W}/${U}/${e}_libretro.js`,resolveCoreWasm:e=>`${$}/${I}@${W}/${U}/${e}_libretro.wasm`,resolveRom(e){if("string"!=typeof e)return e||[];if((t=e)&&"string"==typeof t&&["http://","https://","//","data:","blob:"].some((e=>t.startsWith(e))))return e;var t;let a="";if(e.endsWith(".nes")?a="retrobrews/nes-games":e.endsWith(".sfc")?a="retrobrews/snes-games":e.endsWith(".gb")||e.endsWith(".gbc")?a="retrobrews/gbc-games":e.endsWith(".gba")?a="retrobrews/gba-games":e.endsWith(".sms")?a="retrobrews/sms-games":(e.endsWith(".md")||e.endsWith(".bin"))&&(a="retrobrews/md-games"),a){const t=encodeURIComponent(e);return`${$}/${a}@master/${t}`}return e||[]},resolveBios:e=>e||[],resolveShader(e){if(!e)return[];const{path:t}=v,a=`${$}/${V}@${z}/${e}.glslp`,s=e.split(t.sep);s.splice(-1,0,"shaders");return[a,`${$}/${V}@${z}/${s.join(t.sep)}.glsl`]}}}const q=class e{constructor(a){t(this,"emulator"),t(this,"emulatorOptions"),t(this,"options");const s={};N(s,{...e.globalOptions},{...a}),this.options=s}static configure(t){N(e.globalOptions,t)}static async gb(t){return await e.launchSystem("gb",t)}static async gba(t){return await e.launchSystem("gba",t)}static async gbc(t){return await e.launchSystem("gbc",t)}static getCoreForSystem(e){return a[e]}static async launch(t){const a=new e(t);return await a.launch(),a}static async launchSystem(t,a){const s="string"==typeof a||a instanceof Blob||"fileName"in a&&"fileContent"in a?{rom:a}:a,n=e.getCoreForSystem(t);return await e.launch({...s,core:n})}static async megadrive(t){return await e.launchSystem("megadrive",t)}static async nes(t){return await e.launchSystem("nes",t)}static resetToDefault(){e.configure(H())}static async snes(t){return await e.launchSystem("snes",t)}async fetch(e){const{signal:t=null}=this.options;return await fetch(e,{signal:t})}async getBiosOption(){const{bios:e,resolveBios:t}=this.options;if(!e)return[];const a=Array.isArray(e)?e:[e];return await Promise.all(a.map((e=>this.resolveFile(e,t))))}async getCoreOption(){const{core:e,resolveCoreJs:t,resolveCoreWasm:a}=this.options;let s;if("string"==typeof e){const[n,r]=await Promise.all([t(e,this.options),a(e,this.options)]);s={js:n,name:e,wasm:r}}else s=e;let{js:n,name:r,wasm:o}=s;const i=[];return"string"==typeof n&&i.push((async()=>{const e=await this.fetch(n);n=await e.text()})()),"string"==typeof o&&i.push((async()=>{const e=await this.fetch(o);o=await e.arrayBuffer()})()),i.length>0&&await Promise.all(i),{js:n,name:r,wasm:o}}getElementOption(){if("object"!=typeof document)throw new TypeError("document must be an object");let{element:e}=this.options;if("string"==typeof e&&e){const t=document.body.querySelector(e);if(!t)throw new Error(`can not find element "${e}"`);if(!(t instanceof HTMLCanvasElement))throw new TypeError(`element "${e}" is not a canvas element`);e=t}if(e||(e=document.createElement("canvas")),e instanceof HTMLCanvasElement)return e.id="canvas",e;throw new TypeError("invalid element")}getRetroarchCoreOption(){const t={};return N(t,e.globalOptions.retroarchCoreConfig,this.options.retroarchCoreConfig),t}getRetroarchOption(){const t={};return N(t,e.globalOptions.retroarchConfig,this.options.retroarchConfig),t}async getRomOption(){const{resolveRom:e,rom:t}=this.options;if(!t)return[];const a=Array.isArray(t)?t:[t];return await Promise.all(a.map((t=>this.resolveFile(t,e))))}async getShaderOption(){const{resolveShader:e,shader:t}=this.options;if(!t)return[];const a=await e(t,this.options);return Array.isArray(a)?a.length>0?await Promise.all(a.map((e=>this.resolveFile(e)))):[]:a?[await this.resolveFile(a)]:[]}getStyleOption(){const{element:e,style:t}=this.options,a={backgroundColor:"black",imageRendering:"pixelated"};if(e)return N(a,t),a;const s={height:"100%",left:"0",position:"fixed",top:"0",width:"100%",zIndex:"1"};return N(s,a,t),s}async launch(){await this.loadEmulatorOptions(),A(this.options.signal),this.loadEmulator(),this.options.runEmulatorManually||await this.launchEmulator()}loadEmulator(){const e=this.getEmulatorOptions(),t=new D(e);this.emulator=t}async loadEmulatorOptions(){const{beforeLaunch:e,emscriptenModule:t={},onLaunch:a,respondToGlobalEvents:s=!0,signal:n,size:r="auto",state:o,waitForInteraction:i}=this.options,c=this.getElementOption(),m=this.getStyleOption(),l=this.getRetroarchOption(),u=this.getRetroarchCoreOption(),[p,h,d,f]=await Promise.all([this.getCoreOption(),this.getRomOption(),this.getBiosOption(),this.getShaderOption()]);A(n);const g={beforeLaunch:e,bios:d,core:p,element:c,emscriptenModule:t,nostalgist:this,onLaunch:a,respondToGlobalEvents:s,retroarchConfig:l,retroarchCoreConfig:u,rom:h,shader:f,signal:n,size:r,state:o,style:m,waitForInteraction:i};this.emulatorOptions=g}async resolveFile(e,t){let a,s="";if(e instanceof File)a=e,s=e.name;else if(e instanceof Blob)a=e,s="rom.bin";else if("string"==typeof e){const n=await this.resolveStringFile(e,t);s=n.fileName,a=n.fileContent}else"string"==typeof e.fileName&&(s=e.fileName),e.fileContent instanceof Blob&&(a=e.fileContent);if(!a)throw new TypeError("file content is invalid");return s=s?s.replaceAll(/["%*/:<>?\\|]/g,"-"):"rom.bin",{fileContent:a,fileName:s}}async resolveStringFile(e,t){let a,s=_(e);const n=t?await t(e,this.options):e;if(!n)throw new Error("file is invalid");if(n instanceof Blob)a=n;else if("string"==typeof n){s=_(n);const e=await this.fetch(n);a=await e.blob()}return{fileContent:a,fileName:s}}exit({removeCanvas:e=!0}={}){this.getEmulator().exit(),e&&this.getCanvas().remove()}getCanvas(){return this.getEmulatorOptions().element}getEmscripten(){return this.getEmulator().getEmscripten()}getEmscriptenAL(){return this.getEmulator().getEmscripten().AL}getEmscriptenFS(){return this.getEmulator().getEmscripten().Module.FS}getEmscriptenModule(){return this.getEmulator().getEmscripten().Module}getEmulator(){const{emulator:e}=this;if(!e)throw new Error("emulator is not ready");return e}getEmulatorOptions(){if(!this.emulatorOptions)throw new Error("emulator options are not ready");return this.emulatorOptions}getOptions(){return this.options}async launchEmulator(){return await this.getEmulator().launch()}async loadState(e){await this.getEmulator().loadState(e)}pause(){this.getEmulator().pause()}async press(e){const t=this.getEmulator();await("string"==typeof e?t.press(e):t.press(e.button,e.player,e.time))}pressDown(e){const t=this.getEmulator();return"string"==typeof e?t.pressDown(e):t.pressDown(e.button,e.player)}pressUp(e){const t=this.getEmulator();return"string"==typeof e?t.pressUp(e):t.pressUp(e.button,e.player)}resize(e){return this.getEmulator().resize(e)}restart(){this.getEmulator().restart()}resume(){this.getEmulator().resume()}async saveState(){return await this.getEmulator().saveState()}async screenshot(){const e=this.getEmulator();return await e.screenshot()}sendCommand(e){return this.getEmulator().sendCommand(e)}};return t(q,"globalOptions",H()),t(q,"Nostalgist",q),t(q,"vendors",v),q}));
//# sourceMappingURL=/sm/d5c4dd5841ac426b22db1169990e704dfa9938a4861cc3714e0dc3f54ac762a8.map